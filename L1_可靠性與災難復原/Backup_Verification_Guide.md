# 備份驗證與恢復測試操作指南
# Backup Verification & Restore Testing Operations Guide

> **文件版本 Document Version**: v1.0  
> **最後更新 Last Updated**: 2026-02-08  
> **培訓時數 Training Hours**: 20小時 (P1關鍵技能，3月初)  
> **優先級 Priority**: 🟠 P1 關鍵生存級  
> **受眾 Audience**: IT基礎設施工程師、系統管理員、備份管理人、ISMS管理者  
> **前置條件 Prerequisites**: 理解3-2-1-1-0備份策略、Proxmox VE基礎、SQL Server基礎  
> **當前狀況 Current Status**: Veeam已部署但無定期恢復測試 ⚠️  
> **目標 Objectives**: 建立月度備份驗證流程、確保RTO/RPO可達成、ISO 27001 A17.1.3合規

---

## 📋 課程大綱 Course Outline

### 模組1：Veeam備份基礎與架構 (4小時)
**Veeam Backup Architecture & Components**

### 模組2：備份監控與告警設置 (4小時)
**Backup Monitoring & Alert Configuration**

### 模組3：還原測試操作與驗證 (8小時)
**Restore Testing Operations & Validation**

### 模組4：月度自動化與報告 (4小時)
**Monthly Automation & Reporting**

---

## 第一天：Veeam備份基礎
## Day 1: Veeam Backup Fundamentals (4 hours)

### 模組1.1：Veeam架構與概念 (2小時)

```
Veeam Backup & Replication v12 架構

本公司環境:
┌─────────────────────────────────────┐
│ 數據中心 (On-Premise)              │
├─────────────────────────────────────┤
│                                    │
│  生產系統層 (Production Tier):      │
│  ├─ Proxmox VE 3節點叢集           │
│  │   └─ 12台虛擬機 (核心應用)     │
│  ├─ SQL Server Always On            │
│  │   └─ 2個副本 (Replica)         │
│  └─ NAS儲存 (核心資料)             │
│                                    │
│  Veeam備份層 (Backup Tier):        │
│  ├─ Veeam Backup伺服器             │
│  │   ├─ 備份工作設置與管理         │
│  │   ├─ 監控與報警                 │
│  │   └─ 恢復編排                   │
│  └─ Veeam代理伺服器 (3台)          │
│      ├─ 代理 #1 (Proxmox)          │
│      ├─ 代理 #2 (SQL伺服器)       │
│      └─ 代理 #3 (檔案伺服器)      │
│                                    │
│  備份儲存層 (Backup Storage):      │
│  ├─ 本地備份儲存庫 (Local)         │
│  │   ├─ 位置: /mnt/backup (NAS)   │
│  │   ├─ 容量: 50TB                 │
│  │   ├─ 保留期: 30天 (備份檔)     │
│  │   └─ 用途: 快速恢復             │
│  ├─ 異地備份 (Offsite)             │
│  │   ├─ Backblaze B2雲端儲存       │
│  │   ├─ 容量: 50TB                 │
│  │   ├─ 保留期: 90天               │
│  │   └─ 用途: 災難恢復             │
│  └─ 離線備份 (Offline)             │
│      ├─ 每週手動匯出+光碟存檔      │
│      ├─ 保留期: 1年 (法律要求)   │
│      └─ 用途: 長期存檔+空氣隔閡   │
│                                    │
└─────────────────────────────────────┘

備份策略 (3-2-1-1-0):

3份備份副本 Three Copies:
├─ 副本1: 生產資料 (正在使用)
├─ 副本2: Veeam本地備份 (NAS)
└─ 副本3: Veeam異地備份 (Backblaze B2)

2種不同媒體 Two Different Media:
├─ 媒體1: 磁碟 (SAN/NAS) - 快速恢復
└─ 媒體2: 雲端 (S3/B2) - 異地容錯

1個離線副本 One Offsite Copy:
└─ 離線備份: 每週手動匯出到光碟/外接HDD (防勒索軟體)

1個隔離副本 One Isolated Copy:
└─ 空氣隔離: 儲存在隔離區域，無網路連接

0個靠近副本 Zero Near Site Copies:
└─ 任何單點故障都有副本備份

當前狀況檢查:

✅ 已實現:
├─ Veeam自動備份 (每日差分備份)
├─ Proxmox VM備份
├─ SQL Server差分日誌備份
├─ NAS檔案備份
├─ 本地NAS備份儲存庫 (50TB)
├─ 異地B2雲端備份 (90天保留)
└─ 備份加密 (AES-256)

❌ 缺失:
├─ 定期恢復測試 (無計畫!)
├─ RTO/RPO驗證 (未量化)
├─ 備份完整性檢查 (無驗證)
├─ 故障恢復演練 (無演練)
├─ 月度報告自動化 (手動彙整)
├─ 員工知識文檔 (無SOP)
└─ ISO A17稽核證據 (缺乏記錄)

目標狀況 (本課程結束後):

✅ 將實現:
├─ 月度完整VM恢復測試
├─ 月度檔案級恢復測試
├─ 月度SQL資料庫恢復驗證
├─ RTO驗證 (<4小時)
├─ RPO驗證 (最多丟失<1天)
├─ 備份完整性檢查 (每月自動)
├─ 故障恢復時間測量
├─ 稽核報告自動生成
└─ ISO 27001 A17完整證據
```

---

### 模組1.2：RTO/RPO與恢復目標 (2小時)

```
關鍵概念復習 (來自DR/BCP課程)

RTO (Recovery Time Objective) - 恢復時間目標:
"系統必須在多長時間內恢復?"

本公司RTO設置:

┌─────────────────────────────────────┐
│ 系統優先級與RTO目標                 │
├─────────────────────────────────────┤
│ P0 (關鍵生存):                      │
│ ├─ AD網域控制器: <30分鐘            │
│ ├─ VPN伺服器: <30分鐘               │
│ ├─ SQL Always On: <1小時            │
│ └─ 郵件伺服器: <4小時               │
│                                    │
│ P1 (重要):                          │
│ ├─ 應用伺服器: <4小時               │
│ ├─ 檔案伺服器: <8小時               │
│ └─ 監控系統: <8小時                 │
│                                    │
│ P2 (一般):                          │
│ ├─ 開發機器: <24小時                │
│ ├─ 測試系統: <24小時                │
│ └─ 非關鍵應用: <24小時              │
└─────────────────────────────────────┘

RPO (Recovery Point Objective) - 恢復點目標:
"能夠接受丟失多長時間的資料?"

本公司RPO設置:

┌─────────────────────────────────────┐
│ 系統優先級與RPO目標                 │
├─────────────────────────────────────┤
│ P0 (關鍵生存):                      │
│ ├─ AD網域控制器: <1小時             │
│ ├─ SQL Always On: <15分鐘 (同步複製) │
│ └─ 交易資料: <1小時                 │
│                                    │
│ P1 (重要):                          │
│ ├─ 應用資料: <4小時                 │
│ ├─ 檔案伺服器: <1天                 │
│ └─ 信箱資料: <4小時                 │
│                                    │
│ P2 (一般):                          │
│ ├─ 開發資料: <1天                   │
│ ├─ 測試資料: <1天                   │
│ └─ 檔案歸檔: <7天                   │
└─────────────────────────────────────┘

恢復目標驗證步驟:

步驟1: 建立目標清單 (Target List)
└─ 列出所有系統 + RTO + RPO

步驟2: 執行完整恢復測試 (Full Test)
└─ 從備份還原到隔離環境
└─ 測量恢復耗時 (比較RTO目標)
└─ 驗證資料到點 (比較RPO目標)

步驟3: 記錄與分析 (Documentation)
└─ 紀錄實際恢復時間
└─ 識別瓶頸 (網路? 儲存? 驗證?)
└─ 評估是否達成目標

步驟4: 改善 (Improvement)
└─ 若未達成: 採取改善措施
├─ 更快的儲存 (SSD而非HDD)
├─ 更寬的網路頻寬
├─ 更頻繁的備份 (提升RPO)
├─ 預先建立恢復環境 (減少RTO)
└─ 自動化恢復流程 (減少人工時間)

當前RTO/RPO驗證結果 (假設2025年測試):

系統: AD網域控制器
├─ 目標RTO: <30分鐘
├─ 實際RTO: 45分鐘 ❌ (超過目標)
├─ 原因: 系統開機驗證耗時15分鐘
├─ 改善: 預先建立DC克隆，快速啟動
└─ 修訂RTO: <30分鐘 (改善後)

系統: SQL Server
├─ 目標RTO: <1小時, RPO: <15分鐘
├─ 實際RTO: 45分鐘 ✅ (符合)
├─ 實際RPO: 10分鐘 ✅ (符合, Always On同步複製)
├─ 評估: 達成目標
└─ 改善: 無需改善，維持現狀

本課程目標: 建立月度RTO/RPO驗證測試，量化恢復能力
```

---

## 第二至三天：備份監控與告警
## Days 2-3: Backup Monitoring & Alerts (4 hours)

### 模組2.1：Veeam監控儀表板 (2小時)

```
Veeam Backup & Replication - 監控介面

主儀表板 (Main Dashboard):
┌────────────────────────────────────────┐
│ Veeam Backup Console v12               │
├────────────────────────────────────────┤
│                                        │
│ 📊 備份作業狀態 (Backup Jobs Status)  │
│ ├─ 成功: 47個作業 ✅                  │
│ ├─ 警告: 1個作業 ⚠️                   │
│ │   └─ "SQL_Incremental_Backup"      │
│ │       └─ 警告: 備份視窗超時        │
│ └─ 失敗: 0個作業 ✅                   │
│                                        │
│ 📈 儲存使用情況 (Storage Usage)       │
│ ├─ 本地NAS: 32TB / 50TB (64%) 🟡     │
│ │   └─ 增長趨勢: 每月+2TB            │
│ └─ Backblaze B2: 28TB / 50TB (56%)   │
│                                        │
│ ⏱️  備份工作時間 (Job Duration)       │
│ ├─ 平均: 3.2小時                     │
│ ├─ 最長: SQL完整備份 (5.5小時)      │
│ └─ 最短: 增量備份 (0.5小時)         │
│                                        │
│ 🔄 還原測試記錄 (Restore Tests)      │
│ ├─ 上次完整測試: 2025-12-15          │
│ ├─ 成功: 8個系統 ✅                  │
│ └─ 失敗: 0個系統 ✅                  │
│                                        │
│ 🚨 告警統計 (Recent Alerts)          │
│ ├─ 過去7天: 0個嚴重告警              │
│ ├─ 過去30天: 3個警告                 │
│ └─ 過去90天: 5個警告                 │
│                                        │
└────────────────────────────────────────┘

監控關鍵指標 (KPIs):

指標1: 備份成功率 (Backup Success Rate)
├─ 定義: 成功完成的備份工作數 / 總工作數
├─ 目標: >95% (可接受)
├─ 當前: 98% ✅
├─ 計算: 47成功 / (47成功 + 1失敗) = 98%
└─ 改善: 監控那1個失敗的作業

指標2: 備份視窗遵守率 (Backup Window Compliance)
├─ 定義: 在計畫時間內完成的備份 / 總備份
├─ 目標: >90%
├─ 計算: 
│   ├─ SQL完整備份: 18:00-23:59 (5.5h視窗)
│   ├─ 實際完成時間: 18:30-23:45 (符合) ✅
│   └─ 整體: 46/47作業符合 = 98% ✅
└─ 改善: 無需改善，維持現狀

指標3: 儲存效率 (Storage Efficiency)
├─ 定義: 備份資料大小 / 實際存儲空間
├─ 目標: >1.5倍 (壓縮率)
├─ 當前效率:
│   ├─ 源資料: 8TB (生產系統)
│   ├─ 儲存空間: 32TB (本地NAS)
│   ├─ 效率: 8TB / 32TB = 0.25倍 (低!)
│   └─ 原因: 備份保留30天，含多個版本
└─ 改善: 啟用智能去重 (Deduplication)

指標4: 回復測試頻率 (Restore Test Frequency)
├─ 目標: 月度 (每月至少1次)
├─ 當前: 3個月1次 (不足!)
├─ 測試清單:
│   ├─ 完整VM恢復: 季度1次
│   ├─ 檔案級恢復: 月度1次
│   └─ SQL資料庫恢復: 月度1次
└─ 改善: 實施月度測試計畫 (本課程目標)

監控設置步驟 (Setup Steps):

Step 1: 開啟Veeam Backup Console
└─ Windows: Veeam Backup & Replication → 連接
└─ 帳號: veeam_admin
└─ 密碼: [VAULT中儲存]

Step 2: 檢查作業狀態
└─ 導航: Home → Backup Infrastructure → Jobs
└─ 檢查項:
   ├─ 所有作業是否為"Success"?
   ├─ 作業完成時間是否在視窗內?
   ├─ 是否有警告或錯誤訊息?
   └─ 本地儲存空間是否足夠?

Step 3: 設置告警 (Alerts)
└─ 導航: Home → Settings → Notifications
└─ 配置項:
   ├─ 備份失敗 → 立即傳送電子郵件給CISO
   ├─ 備份警告 → 傳送給IT部長
   ├─ 儲存空間不足 (>80%) → 傳送警告
   ├─ 還原測試失敗 → 傳送給技術領隊
   └─ RTO超過目標 → 傳送升級通知

Step 4: 設置每日檢查任務
└─ 誰: IT工程師 (輪流值班)
└─ 何時: 每天09:00 (備份完成後)
└─ 檢查項:
   ├─ 昨晚所有備份成功嗎?
   ├─ 有沒有警告或錯誤?
   ├─ 本地儲存空間狀況?
   └─ 有沒有RTO/RPO違反?
   └─ 檔案輪轉: 快速完成vs超時?
└─ 文檔: 備份日誌檔案 (daily_backup_log.txt)
```

---

### 模組2.2：備份告警與故障排除 (2小時)

```
常見備份故障與解決方案

故障1: 備份作業超時 (Timeout)
├─ 症狀: 作業未在預期時間內完成
├─ 例: SQL完整備份 (預期5.5小時) 耗時7小時
│
├─ 根本原因分析:
│   ├─ 可能原因A: 網路速度慢 (備份走網路)
│   ├─ 可能原因B: 儲存I/O瓶頸 (磁碟忙碌)
│   ├─ 可能原因C: 源系統性能差 (CPU/記憶體)
│   └─ 可能原因D: 備份資料量增加
│
├─ 診斷步驟:
│   1. 檢查Veeam日誌:
│      └─ C:\ProgramData\Veeam\Backup\Veeam.Backup.VbrServer.log
│      └─ 搜尋"timeout", "failed", "error"關鍵字
│   
│   2. 監控網路:
│      └─ 備份期間測量網路帶寬使用
│      └─ 指令: netstat -b (監視進程)
│      └─ 目標: >900Mbps (1Gbps網路滿載)
│   
│   3. 監控儲存:
│      └─ 備份期間監視NAS/SAN I/O
│      └─ 指令: iostat -x 1 (Linux NAS)
│      └─ 目標: 磁碟繁忙度 <80%
│   
│   4. 檢查源系統:
│      └─ 監視VM/伺服器CPU/記憶體
│      └─ 目標: CPU <70%, 記憶體 <80%
│
├─ 解決方案:
│   ├─ 若為網路: 升級至1.25G或10G網路
│   ├─ 若為儲存: 使用SSD儲存庫而非HDD
│   ├─ 若為源系統: 增加資源或在非尖峰時段備份
│   ├─ 若為資料量: 調整保留策略 (減少備份版本)
│   └─ 若為代理過載: 添加額外代理伺服器
│
└─ 預防:
   ├─ 實施月度性能監視
   ├─ 預留備份視窗增量 (備份時間 + 30%)
   ├─ 定期清理過期備份
   └─ 監視儲存成長趨勢

故障2: 備份失敗 (Failed)
├─ 症狀: 紅色X標記, 作業無法完成
├─ 常見原因:
│   ├─ 代理無法連接到源系統
│   ├─ 備份儲存庫滿 (no space)
│   ├─ 認證失敗 (密碼錯誤)
│   └─ 系統維護 (系統關閉, 網路中斷)
│
├─ 解決方案:
│   ├─ 檢查日誌: Veeam.Backup.VbrServer.log
│   ├─ 驗證連通性: ping <源系統> / nslookup
│   ├─ 檢查儲存: df -h <NAS>, 清理空間
│   ├─ 驗證認證: 測試帳號 (Domain\user+密碼)
│   ├─ 重試作業: Console → 右鍵 → Start Now
│   └─ 若持續失敗: 通知資安人員升級
│
└─ 立即行動:
   ├─ 失敗 <4小時內: 手動重試1次
   ├─ 失敗 >4小時: 升級P1事件
   └─ 連續失敗 >2次: 升級P0危機

故障3: 儲存空間不足 (Insufficient Space)
├─ 症狀: 備份立即失敗, 錯誤 "Insufficient space"
├─ 原因: 
│   ├─ 備份保留期設置過長
│   ├─ 備份資料增長超過預期
│   ├─ 去重/壓縮效率低
│   └─ 其他應用佔用儲存空間
│
├─ 監控與警告:
│   ├─ 儲存 >80% → 發送警告
│   ├─ 儲存 >90% → 發送嚴重警告
│   ├─ 儲存 >95% → 自動禁用非關鍵備份
│   └─ 儲存 100% → 備份停止
│
├─ 解決方案:
│   ├─ 短期 (1天內):
│   │   └─ 刪除舊的測試備份
│   │   └─ 清理本地臨時檔案
│   │   └─ 啟用智能去重
│   │
│   ├─ 中期 (1周內):
│   │   └─ 調整保留策略 (30天 → 14天)
│   │   └─ 遷移舊備份到冷儲存 (B2 Glacier)
│   │   └─ 增加NAS容量
│   │
│   └─ 長期 (1月內):
│       └─ 購買額外NAS (100TB)
│       └─ 實施分層儲存 (SSD + HDD)
│       └─ 啟用完全去重 (區塊級)
│
└─ 儲存成長預測:
   ├─ 當前: 32TB / 50TB (64%)
   ├─ 月度增長: +2TB
   ├─ 預計滿載: 50TB / (32TB + 2TB/month) = 8個月
   ├─ 行動截止: 第6個月 (購買新NAS)
   └─ 建議: 現在規劃採購

故障4: 還原測試失敗 (Restore Test Failed)
├─ 症狀: Veeam還原測試無法成功
├─ 原因:
│   ├─ 備份檔案損壞
│   ├─ 恢復環境資源不足
│   ├─ 儲存庫連接失敗
│   └─ 權限問題
│
├─ 解決方案:
│   ├─ 驗證備份完整性: Veeam → Backup → Verify
│   ├─ 檢查恢復環境資源 (CPU/記憶體/存儲)
│   ├─ 測試儲存庫連接: ping NAS, 掛載共享
│   ├─ 驗證帳號權限 (復原帳號需要admin)
│   └─ 重試測試 (若無持續故障)
│
└─ 升級:
   ├─ 若備份損壞: 升級P1, 通知技術領隊
   ├─ 若無法恢復: 升級P0, 啟動危機應變
   └─ 日誌紀錄: 完整故障紀錄以供分析
```

---

## 第四至六天：還原測試操作
## Days 4-6: Restore Testing Operations (8 hours)

### 模組3.1：完整VM恢復測試 (3小時)

```
完整虛擬機恢復測試流程 (Full VM Restore)

目標: 驗證整個VM能夠從備份還原到隔離環境

步驟1: 選擇測試對象 (Selection)
├─ 哪些系統需要測試?
│   ├─ P0優先系統: AD DC, SQL, VPN (月度)
│   ├─ P1重要系統: 應用, 檔案伺服器 (月度)
│   └─ P2一般系統: 開發, 測試 (季度)
│
└─ 選擇標準:
   ├─ 月度輪轉: 選擇不同系統, 確保全覆蓋
   ├─ 優先順序: 先測試高優先級系統
   ├─ 時間: 選擇低負載時段 (非營業時間)
   └─ 預計時間: 每個VM恢復 <2小時

步驟2: 準備恢復環境 (Preparation)
├─ 隔離網路: 
│   ├─ VLAN 255 (測試隔離VLAN)
│   ├─ 無網際網路連接
│   ├─ 無法訪問生產系統
│   └─ 目的: 防止測試VM與生產系統衝突
│
├─ 儲存資源:
│   ├─ 隔離SAN區域 (100GB以上)
│   ├─ 若SAN不足: 使用本地NAS暫存
│   └─ 確保有足夠空間 (VM大小 × 1.5)
│
├─ 計算資源:
│   ├─ 隔離Proxmox虛擬機主機
│   ├─ 確保CPU/記憶體足夠
│   ├─ 若資源緊張: 使用L1冷卻主機
│   └─ 預留備用資源
│
└─ 操作步驟:
   ├─ 步驟A: 通知IT團隊測試計畫 (時間/系統)
   ├─ 步驟B: 準備隔離環境檢查清單
   ├─ 步驟C: 安排測試時段 (停止其他工作)
   └─ 步驟D: 準備恢復腳本 (自動化)

步驟3: 執行恢復 (Execution)
┌──────────────────────────────────┐
│ Veeam完整VM恢復步驟              │
├──────────────────────────────────┤
│                                  │
│ 1. 開啟Veeam Backup Console      │
│    └─ 帳號: veeam_admin          │
│                                  │
│ 2. 選擇備份:                     │
│    └─ Home → Backups             │
│    └─ 找到目標系統 (例: SQLPROD) │
│    └─ 右鍵 → Restore VM          │
│                                  │
│ 3. 選擇恢復點 (Recovery Point): │
│    └─ 選擇最新的完整備份         │
│    └─ (例: 2026-02-03 23:45)    │
│    └─ 驗證備份檢查通過 ✅        │
│                                  │
│ 4. 選擇恢復目標:                 │
│    ├─ 恢復至: Proxmox Host #3    │
│    ├─ 儲存位置: Test-SAN-01      │
│    ├─ 網路: VLAN 255 (隔離)      │
│    └─ 電源: 恢復後啟動VM        │
│                                  │
│ 5. 預檢查:                       │
│    ├─ 目標主機有足夠資源嗎? ✅  │
│    ├─ 儲存有足夠空間嗎? ✅      │
│    ├─ 網路配置正確嗎? ✅        │
│    └─ 備份檔案完整嗎? ✅        │
│                                  │
│ 6. 啟動恢復:                     │
│    └─ 按 [Restore] 開始          │
│                                  │
│ 7. 監控進度:                     │
│    ├─ Veeam主控台: 進度條        │
│    ├─ 預計時間: <45分鐘          │
│    ├─ 當前進度: 數據複製 35% ...│
│    └─ 日誌: 無錯誤訊息           │
│                                  │
│ 8. 恢復完成:                     │
│    └─ VM已在隔離VLAN上建立       │
│    └─ VM已啟動 (電源開啟)       │
│    └─ 恢復時間: 42分鐘           │
│                                  │
└──────────────────────────────────┘

步驟4: 驗證恢復 (Validation)
┌──────────────────────────────────┐
│ VM恢復驗證檢查清單                │
├──────────────────────────────────┤
│                                  │
│ ✅ 系統啟動檢查:                 │
│    □ VM能否啟動?                │
│    □ 網路能否連接?               │
│    □ 系統日誌無錯誤?             │
│                                  │
│ ✅ 應用檢查:                     │
│    □ 應用能否啟動? (例: SQL)    │
│    □ 應用日誌無錯誤?             │
│    □ 資料庫數據完整?             │
│    □ 檔案系統檢查無誤?           │
│                                  │
│ ✅ 資料驗證:                     │
│    □ 檔案數量是否符合?           │
│    □ 重要檔案是否存在?           │
│    □ 資料庫記錄是否完整?         │
│    □ 修改時間戳是否正確? (RPO)   │
│                                  │
│ ✅ 網路連接檢查:                 │
│    □ IP地址是否正確?             │
│    □ DNS解析是否正常?            │
│    □ 與其他隔離VM通訊正常?       │
│                                  │
│ ✅ 效能檢查:                     │
│    □ 系統回應速度 <2秒?          │
│    □ CPU使用 <50%?               │
│    □ 記憶體使用 <70%?            │
│                                  │
│ ✅ 恢復時間記錄:                 │
│    □ 開始時間: 2026-02-03 20:00 │
│    □ 完成時間: 2026-02-03 20:42 │
│    □ 耗時: 42分鐘                │
│    □ 目標RTO: <1小時 ✅          │
│    □ 狀態: 符合 PASS             │
│                                  │
└──────────────────────────────────┘

步驟5: 清理 (Cleanup)
├─ 刪除測試VM (釋放儲存空間)
├─ 更新測試紀錄
├─ 歸檔日誌檔案
└─ 準備報告

步驟6: 報告 (Reporting)
└─ 填寫還原測試報告:
   ├─ 系統: SQLPROD
   ├─ 日期: 2026-02-03
   ├─ 備份點: 2026-02-02 23:45
   ├─ 恢復點: 2026-02-03 20:42
   ├─ 耗時: 42分鐘 / 目標 <1小時 ✅
   ├─ 資料驗證: 通過 ✅
   ├─ 狀態: 成功
   ├─ 問題: 無
   ├─ 改善項: 無
   └─ 簽名: IT工程師 + CISO
```

---

### 模組3.2：檔案級與資料庫恢復測試 (3小時)

```
檔案級恢復測試 (File-Level Restore)

目標: 驗證單個檔案可以從備份還原

場景: 用戶誤刪了重要檔案, 需要從備份恢復

操作步驟:

Step 1: 定位備份
└─ 哪個檔案? /data/finance/salary_2026_01.xlsx
└─ 何時修改? 2026-02-01 15:30
└─ 何時刪除? 2026-02-02 09:00
└─ 需要的版本: 2026-02-01 15:00 (刪除前)

Step 2: 開啟檔案恢復精靈
└─ Veeam Console → Backups → 檔案伺服器備份
└─ 右鍵 → Browse
└─ 開啟檔案瀏覽器

Step 3: 瀏覽備份內容
└─ 檔案樹: /data/finance/
└─ 選擇 salary_2026_01.xlsx
└─ 版本歷史: 列出所有可用版本
│   ├─ 2026-02-02 06:00 (最新)
│   ├─ 2026-02-01 18:00
│   ├─ 2026-02-01 15:00 ← 需要的版本
│   └─ 2026-02-01 12:00

Step 4: 選擇恢復版本
└─ 選擇: 2026-02-01 15:00
└─ 原因: 在刪除前的最新版本

Step 5: 執行恢復
└─ 恢復至: 原始位置 (覆蓋已刪除的檔案)
└─ 或恢復至: 臨時位置 (手動確認後複製)
└─ 點選 [Restore Now]

Step 6: 驗證
└─ 檔案是否存在? ✅
└─ 檔案大小是否正確? ✅
└─ 檔案內容是否完整? ✅
└─ 修改時間戳是否為2026-02-01 15:00? ✅

耗時: <5分鐘 (非常快!)

─────────────────────────────────

SQL Server資料庫恢復測試

目標: 驗證SQL資料庫可以從備份還原

場景: SQL Server損壞或資料庫崩潰, 需要恢復到最近的一致點

操作步驟:

Step 1: 識別恢復目標
└─ 資料庫: CompanyDB
└─ 恢復到: 2026-02-02 14:30 (事件發生前)
└─ 恢復位置: 隔離測試伺服器 SQLTEST

Step 2: 開啟Veeam SQL恢復精靈
└─ Veeam Console → Backups → SQL Server備份
└─ 右鍵 → Restore Application Items
└─ 選擇 → SQL Server databases

Step 3: 選擇資料庫備份
├─ 備份集: SQLPROD-Backup-2026-02
├─ 目標DB: CompanyDB
├─ 可用恢復點:
│   ├─ 完整備份: 2026-02-01 23:00
│   ├─ 差分備份: 2026-02-02 09:00
│   ├─ 交易日誌: 2026-02-02 14:30 ← 最近一致點
│   └─ 預計恢復: 完整 + 差分 + 交易日誌

Step 4: 選擇恢復目標
├─ 恢復至: SQLTEST伺服器
├─ 新資料庫名: CompanyDB_Restore_20260202
├─ 恢復到時間點: 2026-02-02 14:30
├─ 復原模式: RECOVERY (立即可用)

Step 5: 執行恢復
└─ Veeam執行:
   ├─ 還原完整備份 (15分鐘)
   ├─ 套用差分備份 (5分鐘)
   ├─ 應用交易日誌 (2分鐘)
   ├─ 驗證一致性 (1分鐘)
   └─ 總耗時: ~23分鐘 ✅ (目標 <30分鐘)

Step 6: 資料庫驗證
└─ SQL Server資料庫狀態: ONLINE ✅
└─ 資料庫完整性檢查:
   ├─ DBCC CHECKDB CompanyDB_Restore_20260202
   ├─ 結果: 無錯誤 ✅
   ├─ 檢查時間: 3分鐘
   └─ 狀態: 一致

Step 7: 資料驗證
└─ 查詢記錄數:
   ├─ SELECT COUNT(*) FROM Customers;
   ├─ 結果: 5,234條 (與生產一致) ✅
└─ 查詢最新記錄:
   ├─ SELECT TOP 5 * FROM Transactions ORDER BY CreateDate DESC;
   ├─ 最新記錄日期: 2026-02-02 14:30
   └─ 狀態: RPO符合 (無資料遺失) ✅

Step 8: 清理
└─ 刪除測試資料庫 CompanyDB_Restore_20260202
└─ 釋放儲存空間

恢復測試總結:
├─ 測試系統: SQLPROD
├─ 測試日期: 2026-02-02
├─ 恢復耗時: 23分鐘 (目標 <30分鐘) ✅
├─ 資料一致: 是 (RPO符合) ✅
├─ 狀態: 成功 PASS ✅
└─ 改善項: 無
```

---

### 模組3.3：RTO/RPO驗證與報告 (2小時)

```
RTO/RPO量化驗證與分析

每次還原測試後，填寫驗證表：

┌────────────────────────────────────┐
│ 還原測試驗證報告                    │
├────────────────────────────────────┤
│                                    │
│ 測試ID: RT-2026-02-001             │
│ 系統: SQL Server (SQLPROD)         │
│ 測試日期: 2026-02-02               │
│ 測試人員: IT工程師 李明             │
│                                    │
│ 📊 RTO (Recovery Time Objective)  │
│ ├─ 類型: 完整資料庫還原            │
│ ├─ 目標RTO: <1小時 (60分鐘)       │
│ ├─ 實際耗時:                       │
│ │   ├─ 備份檔案定位: 1分鐘         │
│ │   ├─ 備份驗證: 2分鐘             │
│ │   ├─ 資料恢復: 15分鐘            │
│ │   ├─ 交易日誌應用: 2分鐘        │
│ │   ├─ 一致性檢查: 2分鐘           │
│ │   ├─ 資料驗證: 2分鐘             │
│ │   └─ 總計: 24分鐘 ✅            │
│ │                                  │
│ ├─ RTO效率: (60-24)/60 = 60% 裕度 │
│ │   └─ 評估: 符合 ✅ (充足裕度)  │
│ │                                  │
│ ├─ 關鍵路徑分析:                   │
│ │   └─ 瓶頸: 資料恢復 (15分鐘)   │
│ │   └─ 改善機會: 
│ │       ├─ 使用更快的NAS儲存
│ │       ├─ 或增加備份代理數量
│ │       └─ 預計可減少至10分鐘
│ │                                  │
│ └─ 結論: RTO需求符合 ✅            │
│                                    │
│ 📊 RPO (Recovery Point Objective)  │
│ ├─ 類型: SQL Server資料庫          │
│ ├─ 目標RPO: <15分鐘 (允許丟失)    │
│ ├─ 備份時間點: 2026-02-02 14:30   │
│ ├─ 資料丟失範圍:                   │
│ │   ├─ 上次備份: 2026-02-02 14:30 │
│ │   ├─ 事件時間: 2026-02-02 14:45 │
│ │   ├─ 資料丟失: 15分鐘 ✅        │
│ │   └─ 評估: RPO邊界內             │
│ │                                  │
│ ├─ 備份策略驗證:                   │
│ │   ├─ 完整備份: 每日23:00        │
│ │   ├─ 差分備份: 每9小時          │
│ │   ├─ 交易日誌: 每15分鐘         │
│ │   └─ 結論: 當前設置符合RPO ✅   │
│ │                                  │
│ └─ 結論: RPO需求符合 ✅            │
│                                    │
│ ✅ 資料驗證:                       │
│ ├─ 資料庫完整性: PASS ✅           │
│ ├─ 記錄計數驗證: PASS ✅           │
│ ├─ 最新記錄檢查: PASS ✅           │
│ ├─ 無資料遺失: 確認 ✅            │
│ └─ 可恢復性: 確認 ✅               │
│                                    │
│ ✅ 總體評估:                       │
│ ├─ RTO達成: 符合 ✅               │
│ ├─ RPO達成: 符合 ✅               │
│ ├─ 備份完整性: 良好 ✅            │
│ ├─ 恢復能力: 已驗證 ✅            │
│ └─ 整體評分: PASS ✅               │
│                                    │
│ 📝 問題與改善項:                   │
│ ├─ 已識別問題: 無                 │
│ ├─ 改善建議:                       │
│ │   ├─ (長期) 升級NAS儲存至10G   │
│ │   ├─ (短期) 增加代理伺服器     │
│ │   └─ (即刻) 保持現狀，監視     │
│ │                                  │
│ └─ 後續行動: 監控下次測試         │
│                                    │
│ 簽名:                              │
│ ├─ 技術人員: 李明 _______         │
│ ├─ 技術領隊: 張三 _______         │
│ └─ CISO: 王五 _______              │
│                                    │
│ 核批日期: 2026-02-02              │
│                                    │
└────────────────────────────────────┘

月度RTO/RPO趨勢分析:

系統: SQLPROD
1月份:
├─ 測試1 (1/5): RTO=25分鐘 ✅, RPO=14分鐘 ✅
├─ 測試2 (1/12): RTO=23分鐘 ✅, RPO=15分鐘 ✅
├─ 測試3 (1/19): RTO=26分鐘 ✅, RPO=13分鐘 ✅
└─ 測試4 (1/26): RTO=24分鐘 ✅, RPO=14分鐘 ✅

平均RTO: 24.5分鐘 (目標 <60分鐘) ✅
平均RPO: 14分鐘 (目標 <15分鐘) ✅
穩定性: 高 (變化 <3分鐘)
評估: 系統表現良好，無改善需求
```

---

## 第七至八天：自動化與報告
## Days 7-8: Automation & Reporting (4 hours)

### 模組4.1：月度測試計畫與自動化 (2小時)

```
月度備份驗證計畫 (Monthly Backup Verification Plan)

月度測試日程表:

2月測試計畫 (2026年2月):
┌─────────────────────────────────┐
│ 系統        │ 測試日期 │ 測試類型   │
├─────────────────────────────────┤
│ AD-DC       │ 2/5  │ 完整VM還原 │
│ SQLPROD     │ 2/8  │ DB完整恢復 │
│ FileServer  │ 2/12 │ 檔案還原   │
│ VPN         │ 2/15 │ 完整VM還原 │
│ AppSrv1     │ 2/19 │ 應用驗證   │
│ AppSrv2     │ 2/22 │ 應用驗證   │
│ MailServer  │ 2/26 │ 完整VM還原 │
└─────────────────────────────────┘

3月-6月測試計畫:

3月: 上個月未測試的系統 (如開發機)
4月: 輪轉複測 (AD-DC, SQLPROD, FileServer)
5月: 新增系統或異地備份測試
6月: 全系統回顧與改善

月度報告:

┌─────────────────────────────────┐
│ 2月月度備份驗證報告              │
├─────────────────────────────────┤
│                                 │
│ 計畫執行 (Execution):           │
│ ├─ 計畫測試數: 7個系統          │
│ ├─ 實際完成: 7個系統 ✅ (100%) │
│ ├─ 失敗: 0個                    │
│ └─ 延期: 0個                    │
│                                 │
│ RTO驗證 (RTO Verification):    │
│ ├─ 目標: 100% 符合              │
│ ├─ 實際: 7/7 符合 ✅ (100%)    │
│ ├─ 平均耗時: 28分鐘             │
│ └─ 評估: 符合預期               │
│                                 │
│ RPO驗證 (RPO Verification):    │
│ ├─ 目標: 100% 符合              │
│ ├─ 實際: 7/7 符合 ✅ (100%)    │
│ ├─ 平均資料丟失: 14分鐘         │
│ └─ 評估: 符合預期               │
│                                 │
│ 資料完整性 (Data Integrity):   │
│ ├─ 檢查項: 7個                  │
│ ├─ 通過: 7個 ✅ (100%)          │
│ ├─ 失敗: 0個                    │
│ └─ 評估: 無資料損壞             │
│                                 │
│ 備份可靠性 (Backup Reliability):│
│ ├─ 可恢復系統: 7/7 ✅ (100%)   │
│ ├─ 平均恢復時間: 28分鐘         │
│ ├─ 最短: 12分鐘 (檔案)         │
│ ├─ 最長: 45分鐘 (完整VM)       │
│ └─ 評估: 系統可靠               │
│                                 │
│ 儲存健康度 (Storage Health):   │
│ ├─ 本地NAS: 32TB / 50TB (64%)  │
│ ├─ 月度增長: +2.5TB             │
│ ├─ 預計滿載: 7個月              │
│ └─ 建議: 第5個月採購新NAS       │
│                                 │
│ 問題與改善:                     │
│ ├─ 已識別: 0個嚴重問題          │
│ ├─ 輕微: 1個 (SQL視窗超時)     │
│ └─ 改善行動:                    │
│    └─ 調整SQL備份開始時間       │
│       (23:00 → 22:00)           │
│                                 │
│ 合規評估 (Compliance):          │
│ ├─ ISO 27001 A17: 符合 ✅      │
│ ├─ 記錄保存: 完整 ✅            │
│ ├─ 簽批: 通過 ✅                │
│ └─ 稽核就緒: 是 ✅              │
│                                 │
│ 結論:                            │
│ └─ 2月備份驗證全部成功 ✅       │
│    所有系統可恢復，RTO/RPO      │
│    符合目標。繼續維持現狀，      │
│    監視儲存成長。              │
│                                 │
│ 簽名:                            │
│ ├─ 技術領隊: 張三 _______       │
│ ├─ IT部長: 李四 _______         │
│ └─ CISO: 王五 _______            │
│                                 │
│ 日期: 2026-03-01               │
│                                 │
└─────────────────────────────────┘

自動化腳本 (PowerShell):

# Veeam月度測試排程
# 每月第一個工作日自動執行

$veeamServer = "10.0.1.100"
$veeamUser = "veeam_admin"

# 連接到Veeam
Connect-VBRServer -Server $veeamServer -User $veeamUser -Password $pwd

# 定義月度測試清單
$testList = @(
    @{ BackupName="SQLPROD"; Type="FullRestore"; Date=(Get-Date).AddDays(-1) },
    @{ BackupName="FileServer"; Type="FileRestore"; Date=(Get-Date).AddDays(-2) },
    @{ BackupName="AD-DC"; Type="FullRestore"; Date=(Get-Date).AddDays(-3) }
)

# 執行每個測試
foreach ($test in $testList) {
    Write-Host "執行測試: $($test.BackupName)"
    
    # 取得備份副本
    $backup = Get-VBRBackup -Name $test.BackupName
    
    # 啟動還原測試
    $restore = $backup | Start-VBRRestoreVM -RecoveryPoint $test.Date
    
    # 等待完成
    Wait-VBRBackup -RestoreSession $restore
    
    # 記錄結果
    $result = @{
        System = $test.BackupName
        Date = Get-Date
        Duration = $restore.Duration
        Status = $restore.Status
        DataVerified = $true
    }
    
    # 匯出至報告
    $result | Export-CSV -Path "C:\Veeam\Reports\monthly_$(Get-Date -Format yyyyMM).csv" -Append
}

# 產生月度報告
Invoke-VBRMonthlyReport -OutputPath "C:\Veeam\Reports\"
```

---

### 模組4.2：ISO 27001稽核證據與持續改善 (2小時)

```
ISO 27001 A17 - 業務連續性管理合規

A17.1.1 計畫與實施
✅ 完成項:
├─ 已建立BCP/DRP政策
├─ 已識別關鍵系統與RTO/RPO
├─ 已部署Veeam備份系統
├─ 已建立備份監控程序
└─ 已進行員工培訓

A17.1.2 單一故障點識別
✅ 已識別的SPOF:
├─ 單一備份儲存庫 → 採取行動: 添加B2異地備份
├─ 單一Veeam伺服器 → 採取行動: 規劃冗餘設置
├─ 單一網路連接 → 採取行動: 計畫多路由配置
└─ 備份視窗過長 → 採取行動: 優化備份性能

A17.1.3 可恢復性測試
✅ 測試紀錄 (ISO要求 年度或更頻繁):
├─ 2025年 (前任):
│   ├─ 2025-06-15: SQLPROD完整還原測試 - 成功
│   └─ 2025-09-20: AD-DC完整還原測試 - 成功
│
├─ 2026年 (當年):
│   ├─ 2026-02-05: AD-DC完整還原 - 成功 (24分鐘)
│   ├─ 2026-02-08: SQLPROD完整還原 - 成功 (23分鐘)
│   ├─ 2026-02-12: FileServer檔案還原 - 成功 (5分鐘)
│   ├─ 2026-02-15: VPN完整還原 - 成功 (30分鐘)
│   ├─ 2026-02-19: AppSrv應用驗證 - 成功 (18分鐘)
│   ├─ 2026-02-22: AppSrv應用驗證 - 成功 (19分鐘)
│   └─ 2026-02-26: MailServer完整還原 - 成功 (35分鐘)
│
└─ 測試頻率: 月度 (超過ISO要求) ✅

✅ 測試結果統計:
├─ 總測試次數: 9次 (2025-2026)
├─ 成功次數: 9次 (100%)
├─ 失敗次數: 0次
├─ 平均恢復時間: 26分鐘
├─ 平均資料丟失: 14分鐘
└─ RTO/RPO達成率: 100%

A17.1.5 - 恢復後維護
✅ 文檔與程序:
├─ DR計畫文檔 (本課程資料)
├─ 備份驗證SOP (每月更新)
├─ RTO/RPO驗證報告 (每月歸檔)
├─ 故障排除指南 (作為參考資料)
└─ 員工培訓紀錄 (完成2026年課程)

持續改善流程:

1️⃣ 問題識別
   ├─ 來源: 月度測試發現
   ├─ 來源: 使用者反饋
   ├─ 來源: 稽核發現
   └─ 來源: 性能監控數據

2️⃣ 根本原因分析 (RCA)
   ├─ 為什麼會發生?
   ├─ 根本原因是什麼?
   ├─ 如何預防重複?
   └─ 文檔完成

3️⃣ 改善計畫
   ├─ 識別解決方案
   ├─ 評估成本與效益
   ├─ 優先排序
   └─ 指派責任人與期限

4️⃣ 實施與驗證
   ├─ 執行改善項
   ├─ 驗證有效性
   ├─ 更新程序與文檔
   └─ 進行後續測試

5️⃣ 記錄與稽核
   ├─ 保存所有紀錄 (法律要求)
   ├─ 稽核報告更新
   ├─ ISMS管理評審輸入
   └─ 外部認證就緒

改善項追蹤表:

┌─────────────────────────────┐
│ 編號 │ 問題    │ 改善方案    │
├─────────────────────────────┤
│ IM-1 │ SQL備份│ 時間偏移    │
│      │ 超時   │ 22:00→23:00│
│      │ 完成   │ ✅ (已實施) │
│      │ 驗證   │ 2月測試無誤 │
├─────────────────────────────┤
│ IM-2 │ 儲存   │ NAS容量規劃 │
│      │ 成長快 │ 採購50TB    │
│      │ 狀態   │ 🔄 (進行中) │
│      │ 期限   │ 2026-04-30 │
├─────────────────────────────┤
│ IM-3 │ 異地   │ B2備份驗證  │
│      │ 備份   │ 每季還原測試│
│      │ 不驗證 │ ⏳ (規劃中) │
│      │ 期限   │ 2026-03-30 │
└─────────────────────────────┘

稽核檢查清單 (準備外部認證):

ISO 27001認證稽核時:
□ 展示BCP/DRP政策與計畫
□ 展示RTO/RPO定義與驗證
□ 展示月度測試紀錄 (9次成功)
□ 展示平均恢復時間 (26分鐘)
□ 展示資料完整性驗證結果
□ 展示根本原因分析報告
□ 展示改善項追蹤與實施
□ 展示員工培訓完成紀錄
□ 展示備份監控與告警
□ 展示儲存健康度報告

稽核預期結果: 符合 (No findings) ✅
```

---

## 課程總結與評估

```
✅ 知識目標達成:

□ 理解Veeam備份架構與3-2-1-1-0策略
□ 掌握備份監控與告警設置
□ 掌握完整VM恢復測試流程
□ 掌握檔案級恢復測試流程
□ 掌握SQL Server資料庫恢復流程
□ 理解RTO/RPO量化驗證方法
□ 掌握月度自動化測試流程
□ 理解ISO 27001 A17合規要求
□ 理解持續改善與稽核流程

✅ 操作能力達成:

□ 能獨立執行完整VM恢復測試
□ 能獨立執行檔案級恢復
□ 能獨立執行SQL資料庫恢復
□ 能監控Veeam備份狀態
□ 能設置與管理備份告警
□ 能填寫恢復測試報告
□ 能分析RTO/RPO性能數據
□ 能使用PowerShell進行自動化

✅ 合規能力達成:

□ ISO 27001 A17.1.1 計畫與實施
□ ISO 27001 A17.1.2 SPOF識別
□ ISO 27001 A17.1.3 可恢復性測試
□ ISO 27001 A17.1.5 恢復後維護
□ 完整文檔與稽核記錄

成功指標:

├─ 月度完整備份驗證: ✅ (100% 執行率)
├─ RTO達成率: ✅ (100% 符合目標)
├─ RPO達成率: ✅ (100% 符合目標)
├─ 資料完整性: ✅ (100% 通過驗證)
├─ 備份可靠性: ✅ (系統可恢復)
├─ 儲存監控: ✅ (無備份失敗)
├─ ISO認證就緒: ✅ (完整證據)
└─ 員工培訓率: ✅ (100% 完成)
```

---

**文檔版本控制與簽批**：

| 版本 | 日期 | 內容 | 審批人 |
|------|------|------|--------|
| v1.0 | 2026-02-08 | 初版，備份驗證完整手冊 | CISO |

---

**EOF - 備份驗證與恢復測試操作指南完成** ✅

恭喜！您已掌握完整的備份驗證與恢復測試能力。
準備好確保資料可恢復性！
